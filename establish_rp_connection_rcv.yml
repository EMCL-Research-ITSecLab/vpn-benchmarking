---
- name: Establish Rosenpass connection on receiver
  hosts: receivers

  tasks:
  - name: Create folder for keys in home directories
    ansible.builtin.file:
      path: "{{ ansible_env.HOME }}/rp-keys"
      state: directory
      mode: '0755'
  - name: Generate secret keys
    ansible.builtin.shell:
      cmd: rp genkey rp-keys/client.rosenpass-secret
    args:
      creates: rp-keys/client.rosenpass-secret
  - name: Extract public keys
    ansible.builtin.shell:
      cmd: rp pubkey rp-keys/client.rosenpass-secret rp-keys/client.rosenpass-public
    args:
      creates: rp-keys/client.rosenpass-public